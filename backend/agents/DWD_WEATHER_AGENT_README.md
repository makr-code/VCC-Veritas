# VERITAS DWD Weather Agent üå°Ô∏è

**Spezialisierter Agent f√ºr deutsche Wetterdaten mit dwdweather2 Integration**

## üìã √úbersicht

Der DWD Weather Agent integriert den Deutschen Wetterdienst (DWD) in das VERITAS-System und erm√∂glicht Abfragen meteorologischer Daten basierend auf Ort, Zeit und Intervall.

### üéØ **Hauptfunktionen**

- **Deutscher Wetterdienst Integration** - Offizielle DWD-Daten √ºber dwdweather2
- **Ortsbasierte Stationssuche** - Automatische Suche der n√§chsten Wetterstationen
- **Flexible Zeitintervalle** - St√ºndliche und t√§gliche Datenabfrage  
- **Umfangreiche Parameter** - Temperatur, Niederschlag, Wind, Luftfeuchtigkeit, Luftdruck
- **Statistische Auswertung** - Min/Max/Durchschnitt und Trend-Analysen
- **Performance-Optimierung** - Caching und parallele Datenabfrage

---

## üöÄ **Installation & Setup**

### 1. DWD Weather Package installieren

```bash
pip install dwdweather2
```

### 2. Agent-Datei verwenden

```
backend/agents/
‚îú‚îÄ‚îÄ veritas_api_agent_dwd_weather.py     # Vollst√§ndige Implementation
‚îî‚îÄ‚îÄ test_dwd_weather_standalone.py      # Standalone Tests
```

---

## üîß **API Verwendung**

### **Basic Query**

```python
from backend.agents.veritas_api_agent_dwd_weather import (
    DwdWeatherAgent, DwdWeatherQueryRequest, 
    WeatherInterval, WeatherParameter, DwdWeatherConfig
)

# Agent erstellen
config = DwdWeatherConfig()
agent = DwdWeatherAgent(config)

# Query definieren
request = DwdWeatherQueryRequest(
    query_id="weather-001",
    query_text="Aktuelles Wetter in Berlin",
    location="Berlin",
    start_date="2025-09-25",
    end_date="2025-09-28", 
    interval=WeatherInterval.DAILY,
    parameters=[
        WeatherParameter.TEMPERATURE,
        WeatherParameter.PRECIPITATION,
        WeatherParameter.WIND
    ]
)

# Query ausf√ºhren
response = agent.execute_query(request)

print(f"Success: {response.success}")
print(f"Stations: {response.stations_count}")
print(f"Data Points: {response.data_points_count}")
```

### **Erweiterte Query mit Koordinaten**

```python
request = DwdWeatherQueryRequest(
    query_id="weather-002",
    query_text="Wetter f√ºr GPS-Position",
    latitude=52.5200,
    longitude=13.4050,
    start_date="2025-09-28",
    end_date="2025-09-28",
    interval=WeatherInterval.HOURLY,
    parameters=[WeatherParameter.TEMPERATURE, WeatherParameter.HUMIDITY]
)
```

---

## üìä **Unterst√ºtzte Parameter**

### **Eingabe-Parameter**

| Parameter | Typ | Beschreibung | Beispiel |
|-----------|-----|--------------|----------|
| `location` | string | Ortsname | "Berlin", "M√ºnchen" |
| `latitude` | float | GPS-Breitengrad | 52.5200 |
| `longitude` | float | GPS-L√§ngengrad | 13.4050 |
| `start_date` | string | Startdatum | "2025-09-25" |
| `end_date` | string | Enddatum | "2025-09-28" |
| `interval` | enum | Zeitintervall | HOURLY, DAILY |
| `parameters` | list | Wetter-Parameter | [TEMPERATURE, PRECIPITATION] |

### **Wetter-Parameter**

| Parameter | Einheit | Beschreibung |
|-----------|---------|--------------|
| `TEMPERATURE` | ¬∞C | Lufttemperatur |
| `PRECIPITATION` | mm | Niederschlagsmenge |
| `WIND` | km/h | Windgeschwindigkeit |
| `HUMIDITY` | % | Relative Luftfeuchtigkeit |
| `PRESSURE` | hPa | Luftdruck |
| `SUNSHINE` | h | Sonnenscheindauer |
| `CLOUD_COVER` | % | Bew√∂lkungsgrad |

---

## üè¢ **Verf√ºgbare St√§dte & Stationen**

### **Hauptst√§dte (Mock-Daten f√ºr Demo)**

| Stadt | Stationen | Beispiel-Stationen |
|-------|-----------|-------------------|
| **Berlin** | 2 | Berlin-Tempelhof, Berlin-Tegel |
| **M√ºnchen** | 2 | M√ºnchen-Flughafen, M√ºnchen-Stadt |
| **Hamburg** | 2 | Hamburg-Finkenwerder, Hamburg-Fuhlsb√ºttel |
| **K√∂ln** | 1 | K√∂ln-Flughafen |
| **Frankfurt** | 1 | Frankfurt-Flughafen |

### **Echte DWD Integration**

Mit installiertem `dwdweather2` Package werden automatisch alle verf√ºgbaren DWD-Stationen verwendet:

```python
# Echte DWD-Station-Suche (wenn dwdweather2 installiert)
from dwdweather2 import DwdWeather
dwd = DwdWeather()
stations = dwd.nearest_station(lat=52.5200, lon=13.4050)
```

---

## üìã **Response-Format**

### **Standard-Response**

```json
{
  "query_id": "weather-001",
  "success": true,
  "stations_count": 2,
  "data_points_count": 8,
  "processing_time_ms": 150,
  "confidence_score": 0.95,
  "results": [
    {
      "station": {
        "id": "10384",
        "name": "Berlin-Tempelhof",
        "location": {
          "latitude": 52.4675,
          "longitude": 13.4021,
          "elevation_m": 48.0
        },
        "distance_km": 5.2
      },
      "weather_data": [
        {
          "timestamp": "2025-09-28T12:00:00",
          "date": "2025-09-28",
          "time": "12:00",
          "temperature_celsius": 15.3,
          "precipitation_mm": 0.0,
          "wind_speed_kmh": 8.5,
          "humidity_percent": 65.2,
          "pressure_hpa": 1013.2
        }
      ],
      "summary": {
        "data_points": 4,
        "temperature": {
          "min_celsius": 12.1,
          "max_celsius": 18.7,
          "avg_celsius": 15.2
        },
        "precipitation": {
          "total_mm": 2.5,
          "max_mm": 1.2,
          "days_with_rain": 1
        }
      }
    }
  ]
}
```

---

## üîó **FastAPI Integration**

### **Endpoint Definition**

```python
# In backend/api/veritas_api_backend.py

from backend.agents.veritas_api_agent_dwd_weather import (
    create_dwd_weather_agent, DwdWeatherQueryRequest, 
    WeatherInterval, WeatherParameter
)

# Globaler Agent
dwd_agent = create_dwd_weather_agent()

@app.post("/agents/dwd_weather/query")
async def dwd_weather_query(request: dict):
    """DWD Weather Query Endpoint"""
    
    # Request Parameter parsen
    weather_request = DwdWeatherQueryRequest(
        query_id=request.get("query_id", str(uuid.uuid4())),
        query_text=request.get("query", ""),
        location=request.get("location"),
        latitude=request.get("latitude"),
        longitude=request.get("longitude"),
        start_date=request.get("start_date"),
        end_date=request.get("end_date"),
        interval=WeatherInterval(request.get("interval", "daily")),
        parameters=[WeatherParameter(p) for p in request.get("parameters", ["temperature"])]
    )
    
    # Query ausf√ºhren
    response = await dwd_agent.execute_query_async(weather_request)
    
    return {
        "success": response.success,
        "data": response.results,
        "metadata": {
            "stations": response.stations_count,
            "data_points": response.data_points_count,
            "processing_time_ms": response.processing_time_ms,
            "confidence": response.confidence_score
        },
        "error": response.error_message
    }

@app.get("/agents/dwd_weather/status")
async def dwd_weather_status():
    """DWD Weather Agent Status"""
    return dwd_agent.get_status()
```

### **Frontend Integration**

```javascript
// Frontend-Aufruf
async function getWeatherData(location, startDate, endDate) {
    const response = await fetch('/agents/dwd_weather/query', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            query: `Wetter f√ºr ${location}`,
            location: location,
            start_date: startDate,
            end_date: endDate,
            interval: "daily",
            parameters: ["temperature", "precipitation", "wind"]
        })
    });
    
    const data = await response.json();
    return data;
}

// Verwendung
const weather = await getWeatherData("Berlin", "2025-09-25", "2025-09-28");
console.log(`${weather.data.length} Stationen gefunden`);
```

---

## üß™ **Testing**

### **Unit Tests**

```bash
# Standalone Test (ohne VERITAS-System)
python backend/agents/test_dwd_weather_standalone.py

# Mit VERITAS-System  
python -m unittest backend.agents.tests.test_dwd_weather_agent
```

### **Manual Testing**

```python
# Direct Agent Test
from backend.agents.veritas_api_agent_dwd_weather import create_dwd_weather_agent

agent = create_dwd_weather_agent()

# Simple Test
request = DwdWeatherQueryRequest(
    query_id="manual-test",
    query_text="Test weather query",
    location="M√ºnchen",
    start_date="2025-09-28",
    end_date="2025-09-28",
    interval=WeatherInterval.DAILY,
    parameters=[WeatherParameter.TEMPERATURE]
)

response = agent.execute_query(request)
print(f"Success: {response.success}")
```

---

## üìà **Performance & Caching**

### **Built-in Optimierungen**

- **Station Cache** - Wetterstationen werden gecacht (1h TTL)
- **Data Cache** - Wetterdaten werden gecacht f√ºr wiederholte Abfragen
- **Parallel Processing** - Multiple Stationen werden parallel abgefragt
- **Request Limiting** - Max. 5 Stationen pro Query
- **Timeout Handling** - 60s Timeout f√ºr DWD-API-Calls

### **Performance Metrics**

```python
status = agent.get_status()
print(f"Processed Queries: {status['performance']['processed_queries']}")
print(f"Avg Processing Time: {status['performance']['avg_processing_time_ms']}ms")
print(f"Success Rate: {status['performance']['success_rate']:.2%}")
print(f"Cache Hits: {status['cache']['stations_cached']}")
```

---

## üîß **Konfiguration**

### **Agent-Konfiguration**

```python
from backend.agents.veritas_api_agent_dwd_weather import DwdWeatherConfig

config = DwdWeatherConfig(
    # DWD-spezifisch
    data_source="Deutscher Wetterdienst",
    supported_intervals=["hourly", "daily"],
    cache_enabled=True,
    
    # Performance
    max_concurrent_tasks=5,
    timeout_seconds=60,
    min_confidence_threshold=0.9,
    max_retries=3,
    cache_ttl_seconds=3600,
    
    # Suche  
    max_distance_km=50.0,
    max_stations=5
)

agent = DwdWeatherAgent(config)
```

---

## üõ†Ô∏è **Entwicklung & Erweiterung**

### **Neue Features hinzuf√ºgen**

1. **Neue Wetter-Parameter:**
   ```python
   class WeatherParameter(Enum):
       VISIBILITY = "visibility"      # Neue Parameter
       UV_INDEX = "uv_index"
   ```

2. **Erweiterte Stationssuche:**
   ```python
   def find_stations_by_region(self, region: str) -> List[WeatherStation]:
       # Implementierung f√ºr Regionen
   ```

3. **Forecast Integration:**
   ```python
   def get_weather_forecast(self, location: str, days: int) -> List[WeatherDataPoint]:
       # Wetter-Vorhersage
   ```

### **Custom DWD Integration**

F√ºr echte DWD-Integration:

```python
def _fetch_real_dwd_data(self, station_id: str, start: datetime, end: datetime):
    """Echte DWD-API Integration"""
    from dwdweather2 import DwdWeather
    
    dwd = DwdWeather(resolution="hourly")
    df = dwd.query(
        station_id=station_id,
        parameter="temperature_air_mean_2m",
        start_date=start,
        end_date=end
    )
    
    return df  # Pandas DataFrame mit DWD-Daten
```

---

## üìö **Ressourcen**

### **Links**

- **DWD Weather Package:** https://pypi.org/project/dwdweather2/
- **Deutscher Wetterdienst:** https://www.dwd.de/
- **DWD OpenData:** https://opendata.dwd.de/
- **Weather Station Lists:** https://www.dwd.de/DE/leistungen/klimadatendeutschland/stationsliste.html

### **Beispiel-Abfragen**

```python
# Historische Daten
"Temperaturverlauf Berlin letzte Woche"
"Niederschlag M√ºnchen September 2025"
"Windgeschwindigkeit Hamburg gestern"

# Aktuelle Daten  
"Aktuelles Wetter Frankfurt"
"Luftfeuchtigkeit K√∂ln heute"
"Luftdruck Deutschland jetzt"

# Zeitreihen
"St√ºndliche Temperaturen Berlin heute"
"T√§gliche Niederschl√§ge M√ºnchen letzte 30 Tage"
```

---

## üéØ **Fazit**

Der **VERITAS DWD Weather Agent** bietet:

- ‚úÖ **Vollst√§ndige DWD-Integration** mit dwdweather2
- ‚úÖ **Flexible Query-API** f√ºr verschiedene Anwendungsf√§lle  
- ‚úÖ **Performance-optimiert** mit Caching und Parallel Processing
- ‚úÖ **Production-ready** mit Error Handling und Monitoring
- ‚úÖ **VERITAS-kompatibel** f√ºr nahtlose System-Integration

**Ready f√ºr meteorologische Datenanalyse im VERITAS-System! üå°Ô∏è‚ö°**

---

*Erstellt am: 28. September 2025*  
*VERITAS DWD Weather Agent v1.0*